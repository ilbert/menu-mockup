<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Menu Mockup</title>
  <style>
    :root{
      --brand:#034ca8;
      --border:#e6e8eb;
      --bg:#f4f6f9;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);overflow:hidden}
    header{background:#fff;height:60px;display:flex;align-items:center;padding:0 20px;border-bottom:1px solid var(--border)}
    .hamburger{width:42px;height:42px;border:1px solid var(--border);background:#fff;cursor:pointer;border-radius:8px;font-size:20px;color:var(--brand)}
    #overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:1000}
    #drawer{position:fixed;inset:0 auto 0 0;background:#fff;z-index:1001;display:none;flex-direction:column;box-shadow:10px 0 30px rgba(0,0,0,.12);width:auto;max-width:96vw}
    .drawer-header{padding:15px 20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;font-weight:900;color:var(--brand)}
    .close-x{border:none;background:none;cursor:pointer;font-size:18px;line-height:1}
    #status{padding:10px;text-align:center;font-size:12px;background:#fff3cd}
    #columns-container{display:flex;flex:1;overflow-x:auto;overflow-y:hidden;background:#fff;scrollbar-width:none;-ms-overflow-style:none}
    #columns-container::-webkit-scrollbar{height:0px}

    .column{flex:0 0 330px;border-right:1px solid #eee;overflow-y:auto;height:100%}
    @media (max-width:520px){.column{flex-basis:86vw}}

    ul{list-style:none;padding:0;margin:0}
    .item{padding:14px 20px;display:flex;justify-content:space-between;align-items:center;gap:10px;cursor:pointer;font-size:13px;border-bottom:1px solid #f3f4f6}
    .item:hover{background:#f7f9fc;color:var(--brand)}
    .item.active{background:#e6f2fa;color:var(--brand);font-weight:800;border-left:5px solid var(--brand)}

    .label{display:flex;align-items:center;gap:10px;min-width:0}
    .text{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .icon{width:22px;height:22px;display:inline-grid;place-items:center;font-size:18px;flex:0 0 auto}

    .chevron{width:22px;height:22px;display:inline-flex;align-items:center;justify-content:center;flex:0 0 auto}
    .chevron svg{width:18px;height:18px;stroke:var(--brand);stroke-width:2.6;fill:none;stroke-linecap:round;stroke-linejoin:round}

    .column-header{padding:14px 16px 8px;font-weight:900;color:var(--brand);font-size:18px;display:flex;align-items:center;gap:10px}
    .view-all{display:block;padding:0 16px 12px;color:var(--brand);text-decoration:underline;font-weight:650;font-size:14px}

    .back-only{border:none;background:transparent;padding:0;cursor:pointer;display:inline-flex;align-items:center}

    .divider{border-top:1px solid #e5e7eb;margin:8px 0;}
    .tag{font-size:12px;font-weight:800;padding:2px 8px;border-radius:999px;margin-left:8px;white-space:nowrap}
    .tag.new{background:#e6f2fa;color:var(--brand)}
    .tag.trending{background:#eafaf1;color:#0a8f4e}
  
    /* Banner promo en menÃº principal */
    .promo-card{
      margin:16px;
      border-radius:14px;
      overflow:hidden;
      position:relative;
      background:#0b5ed7;
      box-shadow:0 10px 25px rgba(0,0,0,.12);
    }
    .promo-img{
      width:100%;
      height:160px;
      object-fit:cover;
      display:block;
    }
    .promo-overlay{
      position:absolute;
      inset:0;
      background:linear-gradient(90deg, rgba(0,0,0,.55) 0%, rgba(0,0,0,.25) 55%, rgba(0,0,0,0) 100%);
    }
    .promo-link{
      position:absolute;
      inset:0;
      display:block;
    }

  
    .promo-card.small{ margin:12px 16px 8px; }
    .promo-card.small .promo-img{ height:120px; }
    
  </style>
</head>
<body>
<header>
  <button class="hamburger" id="openBtn">â˜°</button>
  <div style="margin-left:15px;font-weight:900;color:var(--brand);">MENU MOCKUP</div>
</header>

<div id="overlay"></div>

<aside id="drawer">
  <div class="drawer-header">
    <span></span>
    <button class="close-x" id="closeBtn" aria-label="Cerrar">âœ•</button>
  </div>
  <div id="status">Cargando categorÃ­as desde Google Sheets...</div>
  <div id="columns-container"></div>
</aside>

<script>

  // âœ… Tu CSV publicado
  const DATA_URL_BASE = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTB17XxLBUzcUlZZeEh-UPryJijWIBOlec4xgD3BZ9JnF_zy3zKPdlMZpfLpr8bEygm2z5fLhp-ZxFk/pub?gid=0&single=true&output=csv";
  const DATA_URL = DATA_URL_BASE + "&_=" + Date.now();

  const BANNERS_SHEET_NAME = "banners";
  const BANNERS_URL_CANDIDATES = [
    DATA_URL_BASE.replace("gid=0&single=true&output=csv", `single=true&output=csv&sheet=${BANNERS_SHEET_NAME}`),
    DATA_URL_BASE.replace("gid=0&single=true&output=csv", `gid=0&single=true&output=csv&sheet=${BANNERS_SHEET_NAME}`),
  ];
  let bannersConfig = [];


  const CHEVRON_SVG = `<span class="chevron" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M9 6l6 6-6 6"/></svg></span>`;
  const BACK_CHEVRON_SVG = `<span class="chevron" aria-hidden="true" style="transform:rotate(180deg)"><svg viewBox="0 0 24 24"><path d="M9 6l6 6-6 6"/></svg></span>`;

  // ðŸŸ¦ Orden manual del NIVEL 1 (SIN "Total")
  const TOP_ORDER = [
    "Camillas",
    "Mobiliario",
    "Sillas de ruedas",
    "AparatologÃ­a  y equipos",
    "EsterilizaciÃ³n y autoclaves",
    "Material mÃ©dico",
    "Cuidado personal y salud",
    "Desechables y consumibles",
    "Ayudas tÃ©cnicas para personas mayores",
    "Vestuario y seguridad"
  ];

  // Iconos del primer nivel (SIN "Total")
  const ICON_MAP = {
    "aparatologia y equipos":"ðŸ“",
    "ayudas tecnicas para personas mayores":"ðŸ§“",
    "camillas":"ðŸ›ï¸",
    "cuidado personal y salud":"ðŸ§´",
    "desechables y consumibles":"ðŸ§»",
    "diagnostico":"ðŸ©º",
    "electrodomesticos y hogar":"ðŸ ",
    "esterilizacion y autoclaves":"ðŸ§¼",
    "instrumental":"ðŸ§°",
    "material medico":"ðŸ“¦",
    "mobiliario":"ðŸª‘",
    "ofertas y campanas":"ðŸ·ï¸",
    "sillas de ruedas":"ðŸ¦½",
    "vestuario y seguridad":"ðŸ¦º"
  };

  // Iconos para items del menÃº raÃ­z (debajo de Ofertas, etc.)
  const ROOT_ICON_MAP = {
    "especialidades": "â­"
  };

  const OFFERS_ITEMS = [
    { name:"Ofertas del momento", children:[] },
    { name:"MÃ¡s vendidos", children:[] },
    { name:"Promociones", children:[] }
  ];

  // 4 destacadas debajo de â€œOfertasâ€ (root)
  const FEATURED_CATS = [
    { name:"Camillas", tag:"trending" },
    { name:"Sillas de ruedas", tag:"new" },
    { name:"DiagnÃ³stico", tag:null },
    { name:"Mobiliario", tag:null }
  ];

  // Especialidades (debajo de Ofertas)
  const SPECIALTIES_ITEMS = [
    { name:"Fisioterapia", icon:"ðŸ¦µ", children:[] },
    { name:"EstÃ©tica", icon:"âœ¨", children:[] },
    { name:"PeluquerÃ­a y BarberÃ­a", icon:"ðŸ’ˆ", children:[] },
    { name:"SPA & Wellness", icon:"ðŸ§–", children:[] },
    { name:"Medicina", icon:"ðŸ©º", children:[] }
  ];

  const norm = (s) => String(s||"")
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .toLowerCase().trim().replace(/\s+/g," ");

  // âœ… Quita " Total" al final (si existe)
  function displayName(name){
    return String(name||"").replace(/\s+Total\s*$/i,"").trim();
  }

  const getIconForFirstLevel = (name) => ICON_MAP[norm(displayName(name))] || "";

  function slugifyPath(s){
    return String(s||"")
      .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
      .toLowerCase().trim()
      .replace(/\s+/g,"-")
      .replace(/[^a-z0-9\-\/ >]+/g,"")
      .replace(/\s*>\s*/g,"/")
      .replace(/\/+/g,"/")
      .replace(/^-+|-+$/g,"");
  }

  // Ordena hijos alfabÃ©tico (nivel 2+)
  function sortChildrenAlpha(nodes){
    nodes.forEach(n => {
      n.children.sort((a,b)=>displayName(a.name).localeCompare(displayName(b.name)));
      sortChildrenAlpha(n.children);
    });
  }

  // Orden manual del nivel 1
  function sortTopLevel(nodes){
    const rank = new Map(TOP_ORDER.map((n,i)=>[norm(n), i]));
    nodes.sort((a,b)=>{
      const ra = rank.has(norm(displayName(a.name))) ? rank.get(norm(displayName(a.name))) : 9999;
      const rb = rank.has(norm(displayName(b.name))) ? rank.get(norm(displayName(b.name))) : 9999;
      if(ra !== rb) return ra - rb;
      return displayName(a.name).localeCompare(displayName(b.name));
    });
  }

  let menuTree = [];

  const drawer = document.getElementById("drawer");
  const overlay = document.getElementById("overlay");
  document.getElementById("openBtn").onclick = () => toggleMenu(true);
  document.getElementById("closeBtn").onclick = () => toggleMenu(false);
  overlay.onclick = () => toggleMenu(false);


  function updateDrawerWidth(){
    const cols = document.querySelectorAll('#columns-container .column').length || 1;
    const colWidth = 330; // igual que .column
    const desired = cols * colWidth + 1; // +1 para borde
    const maxW = Math.floor(window.innerWidth * 0.96);
    drawer.style.width = Math.min(desired, maxW) + "px";
  }

  window.addEventListener('resize', () => {
    if (drawer.style.display === 'flex') updateDrawerWidth();
  }, { passive: true });


  function toggleMenu(open){
    if(open){
      drawer.style.display="flex";
      drawer.style.width = "330px";
      overlay.style.display="block";
      if(menuTree.length===0) loadData();
      else renderRootMenu();
    } else {
      drawer.style.display="none";
      overlay.style.display="none";
      drawer.style.width = "";
    }
  }

    function parseCsv(text){
    const rows=[]; let row=[]; let cur=""; let inQuotes=false;
    for(let i=0;i<text.length;i++){
      const ch=text[i], next=text[i+1];
      if(ch === '"'){
        if(inQuotes && next === '"'){ cur+='"'; i++; }
        else inQuotes = !inQuotes;
      } else if(ch === ',' && !inQuotes){
        row.push(cur); cur="";
      } else if((ch==='\n' || ch==='\r') && !inQuotes){
        if(ch==='\r' && next==='\n') i++;
        row.push(cur);
        if(row.some(c=>c.trim()!=="")) rows.push(row);
        row=[]; cur="";
      } else cur+=ch;
    }
    if(cur.length || row.length){
      row.push(cur);
      if(row.some(c=>c.trim()!=="")) rows.push(row);
    }
    return rows.map(r=>r.map(c=>c.trim()));
  }

  function rowsToObjects(rows){
    if(!rows.length) return [];
    const header = rows[0].map(h=>norm(h));
    const objs=[];
    for(let i=1;i<rows.length;i++){
      const o={};
      rows[i].forEach((v,idx)=>{ o[header[idx]||("col"+idx)] = (v||"").replace(/^"|"$/g,"").trim(); });
      if(Object.values(o).every(v=>!v)) continue;
      objs.push(o);
    }
    return objs;
  }

  async function loadBanners(){
    for(const baseUrl of BANNERS_URL_CANDIDATES){
      const url = baseUrl + "&_=" + Date.now();
      try{
        const res = await fetch(url);
        if(!res.ok) continue;
        const txt = await res.text();
        if(txt.trim().startsWith("<")) continue;
        const rows = parseCsv(txt);
        const objs = rowsToObjects(rows);
        if(objs.length && (objs[0].scope || objs.find(x=>x.scope))){
          bannersConfig = objs;
          return;
        }
      }catch(e){}
    }
    bannersConfig = [];
  }

  function findBanner({scope,parent,after}){
    const sc = scope ? norm(scope) : "";
    const p = parent ? norm(displayName(parent)) : "";
    const a = after ? norm(displayName(after)) : "";

    // Si hay duplicados en la hoja, gana la ÃšLTIMA fila
    for(let i=bannersConfig.length-1; i>=0; i--){
      const b = bannersConfig[i];
      if(norm(b.scope) !== sc) continue;
      if(p && norm(displayName(b.parent)) !== p) continue;
      if(a && norm(displayName(b.after)) !== a) continue;
      return b;
    }
    return null;
  }

function renderBannerCard(b, extraClass){
    const img0 = b.img || b.image || "";
    if(!img0) return null;

    // Cache-buster: si cambias la URL en Sheets, se refresca seguro
    const img = img0 + (img0.includes('?') ? '&' : '?') + '_=' + Date.now();

    const href = b.href || b.link || "#";
    const alt = b.title || b.alt || "Promo";
    const card = document.createElement("div");
    card.className = "promo-card" + (extraClass ? (" " + extraClass) : "");
    card.innerHTML = `
      <img class="promo-img" src="${img}" alt="${alt}">
      <a class="promo-link" href="${href}" aria-label="${alt}"></a>
    `;
    return card;
  }



</script>
</body>
</html>
